!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.steemWS=e()}}(function(){var e;return function n(e,t,o){function c(r,s){if(!t[r]){if(!e[r]){var a="function"==typeof require&&require;if(!s&&a)return a(r,!0);if(i)return i(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var l=t[r]={exports:{}};e[r][0].call(l.exports,function(n){var t=e[r][1][n];return c(t?t:n)},l,l.exports,n,e,t,o)}return t[r].exports}for(var i="function"==typeof require&&require,r=0;r<o.length;r++)c(o[r]);return c}({1:[function(e,n,t){"use strict";function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var c,i=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),r=e("./WebSocketRpc"),s=e("./SteemApi"),a={url:"wss://node.steem.ws",user:"",pass:"",debug:!1,apis:["database_api","network_broadcast_api"]};n.exports={reset:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return c&&this.close(),c=new u(e),c.connect(),c},get:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=arguments[1];return c||(c=new u(e)),n&&(c.setOptions(e),c.connect()),c},close:function(){c.close(),c=null}};var u=function(){function e(n){o(this,e),this.setOptions(n),this.statusCallback=n.statusCallback}return i(e,[{key:"setOptions",value:function(e){this.options=Object.assign({},a,e),-1===this.options.apis.indexOf("database_api")&&this.options.apis.unshift("database_api")}},{key:"connect",value:function(){if(!this.wsRpc)try{return this.wsRpc=new r(this.options,this.onReconnect.bind(this),this.onStatusChange.bind(this)),this.login()}catch(e){console.error("wsRpc open error:",e)}}},{key:"login",value:function(){var e=this;return this.initPromise=this.wsRpc.login(this.options.user,this.options.pass).then(function(){var n=[];return e.options.apis.forEach(function(t){e["_"+t]=new s(e.wsRpc,t),e[t]=function(){return this["_"+t]},n.push(e["_"+t].init().then(function(){return"database_api"===t?e[t]().exec("get_config",[]).then(function(n){return e.chainId=n.STEEMIT_CHAIN_ID,"connected to "+t}):"connected to "+t}))}),Promise.all(n)})["catch"](function(n){throw new Error("Unable to connect to "+e.options.url)})}},{key:"onReconnect",value:function(){this.login()}},{key:"onStatusChange",value:function(e){this.statusCallback&&this.statusCallback(e)}},{key:"close",value:function(){this.wsRpc&&(this.wsRpc.close(),this.wsRpc=null)}}]),e}()},{"./SteemApi":2,"./WebSocketRpc":3}],2:[function(e,n,t){"use strict";function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var c=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),i=function(){function e(n,t){o(this,e),this.wsRpc=n,this.apiName=t}return c(e,[{key:"init",value:function(){var e=this;return this.wsRpc.getApiByName(this.apiName).then(function(n){return e.apiId=n,e})}},{key:"exec",value:function(e,n){return this.wsRpc.call([this.apiId,e,n])["catch"](function(t){console.error("SteemApi error:",e,n,JSON.stringify(t));var o=new Error("SteemApi error:"+e+n+JSON.stringify(t));throw o.original=t,o})}}]),e}();n.exports=i},{}],3:[function(e,n,t){"use strict";function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var c=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),i=e("./reconnecting-websocket"),r=function(){function n(t){var c=this,r=arguments.length<=1||void 0===arguments[1]?null:arguments[1],s=arguments.length<=2||void 0===arguments[2]?null:arguments[2];o(this,n),this.rcCallback=r,this.statusCallback=s,"undefined"!=typeof WebSocket?(t.WebSocket=WebSocket,t.idleTreshold="idleTreshold"in t?t.idleTreshold:6e4):(t.WebSocket=e("ws"),t.idleTreshold=0),t.reconnectInterval=1e3,t.reconnectDecay=1.2,this.ws=new i(t),this.ws.timeoutInterval=15e3;var a=!0;this.connectPromise=new Promise(function(e,n){c.ws.onopen=function(){c.statusCallback&&c.statusCallback("open"),a?(a=!1,e()):c.rcCallback&&c.rcCallback()},c.ws.onerror=function(e){c.statusCallback&&c.statusCallback("error"),n(e)},c.ws.onmessage=function(e){var n={};try{n=JSON.parse(e.data)}catch(t){console.log("Unable to parse API response:",t),n.error="Unable to parse response "+JSON.stringify(e)}c.listener(n)},c.ws.onclose=function(){c.cbs.forEach(function(e){e.reject("connection closed")}),c.methodCbs.forEach(function(e){e.reject("connection closed")}),c.cbs.clear(),c.methodCbs.clear(),c.cbId=0,c.statusCallback&&c.statusCallback("closed")}}),this.cbId=0,this.cbs=new Map,this.methodCbs=new Map,"undefined"!=typeof window&&(window.onbeforeunload=function(){c.close()})}return c(n,[{key:"listener",value:function(e){var n=this.cbs.get(e.id),t=this.methodCbs.get(e.id);t&&(this.methodCbs["delete"](e.id),"error"in e&&"reject"in t?t.reject(e.error):"resolve"in t&&t.resolve()),n&&(this.cbs["delete"](e.id),"error"in e?n.reject(e.error):n.resolve(e.result))}},{key:"call",value:function(e){var n=this,t={method:"call",params:e,id:this.cbId++};return new Promise(function(e,o){n.cbs.set(t.id,{time:new Date,resolve:e,reject:o}),"broadcast_transaction_with_callback"===t.params[1]&&t.params[2][0]&&(n.methodCbs.set(t.id,t.params[2][0]),t.params[2][0]=t.params[2][0].resolve),n.ws.onerror=function(e){o(e)},n.ws.send(JSON.stringify(t))})}},{key:"getApiByName",value:function(e){return this.call([1,"get_api_by_name",[e]])}},{key:"login",value:function(e,n){var t=this;return this.connectPromise.then(function(){return t.call([1,"login",[e,n]])})}},{key:"close",value:function(){this.ws&&(this.ws.onclose(),this.ws.close(),this.ws=null)}}]),n}();n.exports=r},{"./reconnecting-websocket":5,ws:6}],4:[function(e,n,t){"use strict";var o=e("./ApiInstance");n.exports={Client:o}},{"./ApiInstance":1}],5:[function(n,t,o){"use strict";!function(n,o){"function"==typeof e&&e.amd?e([],o):"undefined"!=typeof t&&t.exports?t.exports=o():n.ReconnectingWebSocket=o()}(void 0,function(){function e(t){function o(e,n){return{name:e}}var c={debug:!1,automaticOpen:!0,reconnectInterval:2e3,maxReconnectInterval:3e5,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:100,binaryType:"arraybuffer",idleTreshold:0};t||(t={}),n=t.WebSocket,e.CONNECTING=n.CONNECTING,e.OPEN=n.OPEN,e.CLOSING=n.CLOSING,e.CLOSED=n.CLOSED,console.debug||(console.debug=console.log);for(var i in c)"undefined"!=typeof t[i]?this[i]=t[i]:this[i]=c[i];this.url=t.url,this.reconnectAttempts=0,this.readyState=n.CONNECTING,this.protocol=null;var r,s=this,a=!1,u=!1,l={},d={addEventListener:function(e,n){l[e]=n},removeEventListener:function(e){delete l[e]},dispatchEvent:function(e){var n=l[e.name];n&&n(e)}};d.addEventListener("open",function(e){s.onopen(e)}),d.addEventListener("close",function(e){s.onclose(e)}),d.addEventListener("connecting",function(e){s.onconnecting(e)}),d.addEventListener("message",function(e){s.onmessage(e)}),d.addEventListener("error",function(e){s.onerror(e)}),this.addEventListener=d.addEventListener.bind(d),this.removeEventListener=d.removeEventListener.bind(d),this.dispatchEvent=d.dispatchEvent.bind(d),s.pendingReconnect=!1,s.idleSince=new Date,this.idleTreshold&&"undefined"!=typeof document&&(document.onkeypress=document.onmousemove=document.onclick=document.onscroll=document.touchstart=function(){s.idleSince=new Date,s.pendingReconnect&&(s.pendingReconnect=!1,s.reconnect())}),this.reconnect=function(){var e=s.reconnectInterval*Math.pow(s.reconnectDecay,s.reconnectAttempts);e=e>s.maxReconnectInterval?s.maxReconnectInterval:e,s.debug&&console.debug("WebSocket: will try to reconnect in "+parseInt(e/1e3)+" sec, attempt #"+(s.reconnectAttempts+1)),setTimeout(function(){s.reconnectAttempts++,s.open(!0)},e)},this.open=function(t){if(t){if(this.maxReconnectAttempts&&this.reconnectAttempts>this.maxReconnectAttempts)return}else d.dispatchEvent(o("connecting")),this.reconnectAttempts=0;var c=s.url;Array.isArray(s.url)&&(c=s.url[this.reconnectAttempts%s.url.length]),s.debug&&console.debug("connecting to",c),r=new n(c),r.binaryType=this.binaryType,(s.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","attempt-connect",s.url);var i=r,l=setTimeout(function(){(s.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","connection-timeout",s.url),u=!0,i.close(),u=!1},s.timeoutInterval);r.onopen=function(c){clearTimeout(l),(s.debug||e.debugAll)&&console.debug("ReconnectingWebSocket**","onopen",s.url),s.protocol=r.protocol,s.readyState=n.OPEN,s.reconnectAttempts=0;var i=o("open");i.isReconnect=t,t=!1,d.dispatchEvent(i)},r.onclose=function(i){if(1e3!==i.code&&s.debug&&console.log("WARNING! ws connection",c,"closed"),clearTimeout(l),r=null,a)s.readyState=n.CLOSED,d.dispatchEvent(o("close"));else{s.readyState=n.CONNECTING;var f=o("connecting");f.code=i.code,f.reason=i.reason,f.wasClean=i.wasClean,d.dispatchEvent(f),t||u||((s.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onclose",s.url),d.dispatchEvent(o("close"))),!s.idleTreshold||new Date-s.idleSince<s.idleTreshold?s.reconnect():(s.debug&&console.debug("idle - will reconnect later"),s.pendingReconnect=!0)}},r.onmessage=function(n){(s.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onmessage",s.url);var t=o("message");t.data=n.data,d.dispatchEvent(t)},r.onerror=function(n){(s.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onerror",s.url,n),d.dispatchEvent(o(n))}},1==this.automaticOpen&&this.open(!1),this.send=function(n){if(r)return(s.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","send",s.url,n),r.send(n);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},this.close=function(e,n){"undefined"==typeof e&&(e=1e3),a=!0,r&&r.close(e,n)},this.refresh=function(){r&&r.close()}}var n;return e.prototype.onopen=function(e){},e.prototype.onclose=function(e){},e.prototype.onconnecting=function(e){},e.prototype.onmessage=function(e){},e.prototype.onerror=function(e){},e.debugAll=!1,e})},{}],6:[function(e,n,t){},{}]},{},[4])(4)});