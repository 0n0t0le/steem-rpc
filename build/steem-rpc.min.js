!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.steemWS=e()}}(function(){var e;return function n(e,t,o){function r(c,s){if(!t[c]){if(!e[c]){var u="function"==typeof require&&require;if(!s&&u)return u(c,!0);if(i)return i(c,!0);var a=new Error("Cannot find module '"+c+"'");throw a.code="MODULE_NOT_FOUND",a}var l=t[c]={exports:{}};e[c][0].call(l.exports,function(n){var t=e[c][1][n];return r(t?t:n)},l,l.exports,n,e,t,o)}return t[c].exports}for(var i="function"==typeof require&&require,c=0;c<o.length;c++)r(o[c]);return r}({1:[function(e,n,t){"use strict";function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var r,i=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),c=e("./WebSocketRpc"),s=e("./SteemApi"),u={url:"wss://node.steem.ws",user:"",pass:"",debug:!1,apis:["database_api","network_broadcast_api"]};n.exports={reset:function(e){return r&&this.close(),r=new a(e),r.connect(),r},get:function(e,n,t){return r||(r=new a(e)),n&&(r.setOptions(e),r.connect()),r},close:function(){r.close(),r=null}};var a=function(){function e(n){o(this,e),this.setOptions(n)}return i(e,[{key:"setOptions",value:function(e){this.options=Object.assign({},u,e),-1===this.options.apis.indexOf("database_api")&&this.options.apis.unshift("database_api")}},{key:"connect",value:function(){var e=this;if(!this.wsRpc){try{this.wsRpc=new c(this.options)}catch(n){console.error("wsRpc open error:",n)}this.initPromise=this.wsRpc.login(this.options.user,this.options.pass).then(function(){var n=[];return e.options.apis.forEach(function(t){e["_"+t]=new s(e.wsRpc,t),e[t]=function(){return this["_"+t]},n.push(e["_"+t].init().then(function(){return"database_api"===t?e[t]().exec("get_config",[]).then(function(n){return e.chainId=n.STEEMIT_CHAIN_ID,"connected to "+t}):"connected to "+t}))}),Promise.all(n)})["catch"](function(n){throw new Error("Unable to connect to "+e.options.url)})}}},{key:"close",value:function(){this.wsRpc&&(this.wsRpc.close(),this.wsRpc=null),this.options=null}}]),e}()},{"./SteemApi":2,"./WebSocketRpc":3}],2:[function(e,n,t){"use strict";function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),i=function(){function e(n,t){o(this,e),this.wsRpc=n,this.apiName=t}return r(e,[{key:"init",value:function(){var e=this;return this.wsRpc.getApiByName(this.apiName).then(function(n){return e.apiId=n,e})}},{key:"exec",value:function(e,n){return this.wsRpc.call([this.apiId,e,n])["catch"](function(t){throw console.error("SteemApi error:",e,n,JSON.stringify(t)),new Error("SteemApi error:"+e+n+JSON.stringify(t))})}}]),e}();n.exports=i},{}],3:[function(e,n,t){(function(t){"use strict";function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),i=e("./reconnecting-websocket"),c=function(){function n(r){var c=this,s=arguments.length<=1||void 0===arguments[1]?null:arguments[1];o(this,n),"undefined"!=typeof WebSocket?r.WebSocket=WebSocket:r.WebSocket=e("websocket").w3cwebsocket,r.idleTreshold=6e4,r.reconnectInterval=1e3,r.reconnectDecay=1.2,this.ws=new i(r.url,[],r),this.ws.timeoutInterval=15e3;var u=!0;this.rcCallback=s,this.connectPromise=new Promise(function(e,n){c.ws.onopen=function(){u?(u=!1,e()):c.rcCallback&&c.rcCallback()},c.ws.onerror=function(e){n(e)},c.ws.onmessage=function(e){var n={};try{n=JSON.parse(e.data)}catch(t){console.log("Unable to parse API response:",t),n.error="Unable to parse response "+JSON.stringify(e)}c.listener(n)}}),this.cbId=0,this.cbs=new Map,t.env.BROWSER&&(window.onbeforeunload=function(){c.close()})}return r(n,[{key:"listener",value:function(e){var n=this.cbs.get(e.id);n&&("error"in e?n.reject(e.error):n.resolve(e.result))}},{key:"call",value:function(e){var n=this,t={method:"call",params:e,id:this.cbId++};return new Promise(function(e,o){n.cbs.set(t.id,{time:new Date,resolve:e,reject:o}),n.ws.onerror=function(e){o(e)},n.ws.send(JSON.stringify(t))})}},{key:"getApiByName",value:function(e){return this.call([1,"get_api_by_name",[e]])}},{key:"login",value:function(e,n){var t=this;return this.connectPromise.then(function(){return t.call([1,"login",[e,n]])})}},{key:"close",value:function(){this.ws&&(this.ws.close(),this.ws=null)}}]),n}();n.exports=c}).call(this,e("_process"))},{"./reconnecting-websocket":5,_process:7,websocket:6}],4:[function(e,n,t){"use strict";var o=e("./ApiInstance");n.exports={Client:o}},{"./ApiInstance":1}],5:[function(n,t,o){(function(n){"use strict";!function(n,o){"function"==typeof e&&e.amd?e([],o):"undefined"!=typeof t&&t.exports?t.exports=o():n.ReconnectingWebSocket=o()}(void 0,function(){function e(o,r,i){function c(e,n){return{name:e}}var s={debug:!1,automaticOpen:!0,reconnectInterval:2e3,maxReconnectInterval:3e5,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:100,binaryType:"arraybuffer",idleTreshold:0};i||(i={}),t=i.WebSocket,e.CONNECTING=t.CONNECTING,e.OPEN=t.OPEN,e.CLOSING=t.CLOSING,e.CLOSED=t.CLOSED,console.debug||(console.debug=console.log);for(var u in s)"undefined"!=typeof i[u]?this[u]=i[u]:this[u]=s[u];this.url=o,this.reconnectAttempts=0,this.readyState=t.CONNECTING,this.protocol=null;var a,l=this,f=!1,p=!1,d={},h={addEventListener:function(e,n){d[e]=n},removeEventListener:function(e){delete d[e]},dispatchEvent:function(e){var n=d[e.name];n&&n(e)}};h.addEventListener("open",function(e){l.onopen(e)}),h.addEventListener("close",function(e){l.onclose(e)}),h.addEventListener("connecting",function(e){l.onconnecting(e)}),h.addEventListener("message",function(e){l.onmessage(e)}),h.addEventListener("error",function(e){l.onerror(e)}),this.addEventListener=h.addEventListener.bind(h),this.removeEventListener=h.removeEventListener.bind(h),this.dispatchEvent=h.dispatchEvent.bind(h),l.pendingReconnect=!1,l.idleSince=new Date,this.idleTreshold&&"undefined"!=typeof document&&(document.onkeypress=document.onmousemove=document.onclick=document.onscroll=document.touchstart=function(){l.idleSince=new Date,l.pendingReconnect&&(l.pendingReconnect=!1,l.reconnect())}),this.reconnect=function(){var e=l.reconnectInterval*Math.pow(l.reconnectDecay,l.reconnectAttempts);e=e>l.maxReconnectInterval?l.maxReconnectInterval:e,console.log("WebSocket: will try to reconnect in "+parseInt(e/1e3)+" sec, attempt #"+(l.reconnectAttempts+1)),setTimeout(function(){l.reconnectAttempts++,l.open(!0)},e)},this.open=function(i){if(i){if(this.maxReconnectAttempts&&this.reconnectAttempts>this.maxReconnectAttempts)return}else h.dispatchEvent(c("connecting")),this.reconnectAttempts=0;var s=l.url;Array.isArray(o)&&(s=l.url[this.reconnectAttempts%l.url.length]),console.log("connecting to",s),a=n.env.BROWSER?new t(s):new t(s,r||[],null,null,null,{maxReceivedFrameSize:3145728}),a.binaryType=this.binaryType,(l.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","attempt-connect",l.url);var u=a,d=setTimeout(function(){(l.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","connection-timeout",l.url),p=!0,u.close(),p=!1},l.timeoutInterval);a.onopen=function(n){clearTimeout(d),(l.debug||e.debugAll)&&console.debug("ReconnectingWebSocket**","onopen",l.url),l.protocol=a.protocol,l.readyState=t.OPEN,l.reconnectAttempts=0;var o=c("open");o.isReconnect=i,i=!1,h.dispatchEvent(o)},a.onclose=function(n){if(1e3!==n.code&&console.log("WARNING! ws connection",s,"closed: ",n&&n.reason?n.reason:n),clearTimeout(d),a=null,f)l.readyState=t.CLOSED,h.dispatchEvent(c("close"));else{l.readyState=t.CONNECTING;var o=c("connecting");o.code=n.code,o.reason=n.reason,o.wasClean=n.wasClean,h.dispatchEvent(o),i||p||((l.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onclose",l.url),h.dispatchEvent(c("close"))),!l.idleTreshold||new Date-l.idleSince<l.idleTreshold?l.reconnect():(console.debug("idle - will reconnect later"),l.pendingReconnect=!0)}},a.onmessage=function(n){(l.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onmessage",l.url,n.data);var t=c("message");t.data=n.data,h.dispatchEvent(t)},a.onerror=function(n){(l.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onerror",l.url,n),h.dispatchEvent(c(n))}},1==this.automaticOpen&&this.open(!1),this.send=function(n){if(a)return(l.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","send",l.url,n),a.send(n);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},this.close=function(e,n){"undefined"==typeof e&&(e=1e3),f=!0,a&&a.close(e,n)},this.refresh=function(){a&&a.close()}}var t;return e.prototype.onopen=function(e){},e.prototype.onclose=function(e){},e.prototype.onconnecting=function(e){},e.prototype.onmessage=function(e){},e.prototype.onerror=function(e){},e.debugAll=!1,e})}).call(this,n("_process"))},{_process:7}],6:[function(e,n,t){},{}],7:[function(e,n,t){function o(){l&&s&&(l=!1,s.length?a=s.concat(a):f=-1,a.length&&r())}function r(){if(!l){var e=setTimeout(o);l=!0;for(var n=a.length;n;){for(s=a,a=[];++f<n;)s&&s[f].run();f=-1,n=a.length}s=null,l=!1,clearTimeout(e)}}function i(e,n){this.fun=e,this.array=n}function c(){}var s,u=n.exports={},a=[],l=!1,f=-1;u.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)n[t-1]=arguments[t];a.push(new i(e,n)),1!==a.length||l||setTimeout(r,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=c,u.addListener=c,u.once=c,u.off=c,u.removeListener=c,u.removeAllListeners=c,u.emit=c,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}]},{},[4])(4)});